{% extends 'main.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">Post Your Ad on Gobonimo</h1>
      <p class="text-slate-300 text-lg max-w-2xl mx-auto">Reach thousands of potential buyers instantly. Post your ad in just a few simple steps.</p>
    </div>

    {% if messages %}
    <div class="mb-4">
      {% for message in messages %}
        <div class="rounded-md p-3 mb-2 {% if message.tags == 'error' %}bg-red-600{% else %}bg-emerald-600{% endif %}">
          <p class="text-sm">{{ message }}</p>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-1">
        <div class="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
              <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
            </svg>
            Marketplace Stats
          </h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center"><span class="text-slate-400">Active Users</span><span class="font-semibold text-blue-400">15,000+</span></div>
            <div class="flex justify-between items-center"><span class="text-slate-400">Daily Visits</span><span class="font-semibold text-green-400">2,500+</span></div>
            <div class="flex justify-between items-center"><span class="text-slate-400">Success Rate</span><span class="font-semibold text-cyan-400">85%</span></div>
          </div>
        </div>

        <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-green-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            Why Choose Gobonimo?
          </h3>
          <ul class="space-y-3">
            <li class="flex items-start"><span class="text-green-400 mr-2">✓</span><span>Free to post with no hidden fees</span></li>
            <li class="flex items-start"><span class="text-green-400 mr-2">✓</span><span>Reach local buyers instantly</span></li>
            <li class="flex items-start"><span class="text-green-400 mr-2">✓</span><span>Secure messaging system</span></li>
            <li class="flex items-start"><span class="text-green-400 mr-2">✓</span><span>Mobile-friendly platform</span></li>
          </ul>
        </div>
      </div>

      <div class="lg:col-span-2">
        <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
          <h2 class="text-2xl font-semibold mb-6">Post Your Paid Ad</h2>

          <!-- Debug Form Errors -->
          {% if form.errors %}
            <div class="bg-red-600 p-4 rounded-lg mb-6">
              <h3 class="font-bold mb-2">Please fix the following errors:</h3>
              <ul class="list-disc list-inside text-sm">
                {% for field in form %}
                  {% for error in field.errors %}
                    <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <form method="POST" enctype="multipart/form-data" id="productForm" class="space-y-6">
            {% csrf_token %}

            <!-- Hidden fields -->
            <input type="hidden" name="advertiser" value="{{ request.user.id }}">
            <input type="hidden" name="status" value="pending">
            <input type="hidden" name="is_featured" value="true">

            <!-- CATEGORY SELECTION -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Select Category *</label>
              <select id="categorySelect" name="category" required class="w-full bg-slate-700 border {% if form.category.errors %}border-red-500{% else %}border-slate-600{% endif %} rounded-lg px-4 py-3 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                <option value="">Select a Category</option>
                {% for c in categories %}
                  <option value="{{ c.id }}" {% if form.category.value == c.id|stringformat:"s" %}selected{% endif %}>{{ c.name }}</option>
                {% endfor %}
              </select>
              {% if form.category.errors %}
                <div class="text-red-400 text-xs mt-1">{{ form.category.errors }}</div>
              {% endif %}
            </div>

            <!-- AD TYPE -->
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Ad Type *</label>
              <select name="ad_type" required class="w-full bg-slate-700 border {% if form.ad_type.errors %}border-red-500{% else %}border-slate-600{% endif %} rounded-lg px-4 py-3 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                <option value="">Select Ad Type</option>
                <option value="sell" {% if form.ad_type.value == "sell" %}selected{% endif %}>For Sale</option>
                <option value="rent" {% if form.ad_type.value == "rent" %}selected{% endif %}>For Rent</option>
                <option value="exchange" {% if form.ad_type.value == "exchange" %}selected{% endif %}>For Exchange</option>
                <option value="service" {% if form.ad_type.value == "service" %}selected{% endif %}>Service</option>
                <option value="job" {% if form.ad_type.value == "job" %}selected{% endif %}>Job</option>
                <option value="other" {% if form.ad_type.value == "other" %}selected{% endif %}>Other</option>
              </select>
              {% if form.ad_type.errors %}
                <div class="text-red-400 text-xs mt-1">{{ form.ad_type.errors }}</div>
              {% endif %}
            </div>

            <!-- BASIC AD FIELDS -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Ad Title *</label>
                <input type="text" name="name" value="{{ form.name.value|default:'' }}" required 
                       class="w-full bg-slate-700 border {% if form.name.errors %}border-red-500{% else %}border-slate-600{% endif %} rounded-lg px-4 py-3 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" 
                       placeholder="What are you selling?">
                {% if form.name.errors %}
                  <div class="text-red-400 text-xs mt-1">{{ form.name.errors }}</div>
                {% endif %}
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Price ($) *</label>
                <input type="number" step="0.01" name="price" value="{{ form.price.value|default:'' }}" required
                       class="w-full bg-slate-700 border {% if form.price.errors %}border-red-500{% else %}border-slate-600{% endif %} rounded-lg px-4 py-3 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" 
                       placeholder="0.00">
                {% if form.price.errors %}
                  <div class="text-red-400 text-xs mt-1">{{ form.price.errors }}</div>
                {% endif %}
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">Description *</label>
              <textarea name="description" rows="4" required 
                        class="w-full bg-slate-700 border {% if form.description.errors %}border-red-500{% else %}border-slate-600{% endif %} rounded-lg px-4 py-3 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" 
                        placeholder="Describe your item in detail...">{{ form.description.value|default:'' }}</textarea>
              {% if form.description.errors %}
                <div class="text-red-400 text-xs mt-1">{{ form.description.errors }}</div>
              {% endif %}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Location *</label>
                <input type="text" name="location" value="{{ form.location.value|default:'' }}" required 
                       class="w-full bg-slate-700 border {% if form.location.errors %}border-red-500{% else %}border-slate-600{% endif %} rounded-lg px-4 py-3 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" 
                       placeholder="City, State">
                {% if form.location.errors %}
                  <div class="text-red-400 text-xs mt-1">{{ form.location.errors }}</div>
                {% endif %}
              </div>
            </div>

            <!-- DYNAMIC CATEGORY-SPECIFIC SECTIONS -->
            <!-- Vehicles Section -->
            <div class="category-section" data-category-name="Vehicles" style="display:none;">
              <div class="mt-6 p-6 bg-slate-700 rounded-lg border border-slate-600">
                <h3 class="text-lg font-semibold mb-4">Vehicle Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Vehicle Type</label>
                    <select name="vehicle_type" class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                      <option value="">Select Type</option>
                      <option value="car" {% if form.vehicle_type.value == "car" %}selected{% endif %}>Car</option>
                      <option value="motorcycle" {% if form.vehicle_type.value == "motorcycle" %}selected{% endif %}>Motorcycle</option>
                      <option value="bus" {% if form.vehicle_type.value == "bus" %}selected{% endif %}>Bus</option>
                      <option value="truck" {% if form.vehicle_type.value == "truck" %}selected{% endif %}>Truck</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Motor Type</label>
                    <input type="text" name="motortype" value="{{ form.motortype.value|default:'' }}"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" placeholder="e.g., Diesel, Petrol, Electric">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Year</label>
                    <input type="number" name="year" value="{{ form.year.value|default:'' }}" min="1900" max="{% now 'Y' %}"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" placeholder="Manufacturing year">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Color</label>
                    <input type="text" name="color" value="{{ form.color.value|default:'' }}"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" placeholder="Vehicle color">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Transmission</label>
                    <select name="geartype" class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                      <option value="">Select Transmission</option>
                      <option value="Automatic" {% if form.geartype.value == "Automatic" %}selected{% endif %}>Automatic</option>
                      <option value="Manual" {% if form.geartype.value == "Manual" %}selected{% endif %}>Manual</option>
                    </select>
                  </div>
                  <div class="flex items-center">
                    <input type="checkbox" id="is_automatic" name="is_automatic" value="true" 
                           {% if form.is_automatic.value %}checked{% endif %} class="h-4 w-4 text-blue-500 focus:ring-blue-400">
                    <label for="is_automatic" class="ml-2 text-slate-300">Automatic Transmission</label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Property Section -->
            <div class="category-section" data-category-name="Property" style="display:none;">
              <div class="mt-6 p-6 bg-slate-700 rounded-lg border border-slate-600">
                <h3 class="text-lg font-semibold mb-4">Property Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Number of Rooms</label>
                    <input type="number" name="num_rooms" value="{{ form.num_rooms.value|default:'' }}" min="0"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Number of Bathrooms</label>
                    <input type="number" name="num_baths" value="{{ form.num_baths.value|default:'' }}" min="0"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Area Size (sq ft/m)</label>
                    <input type="number" name="area_size" value="{{ form.area_size.value|default:'' }}" min="0"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Furnishing Type</label>
                    <select name="furnishing_type" class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                      <option value="">Select Type</option>
                      <option value="fully_furnished" {% if form.furnishing_type.value == "fully_furnished" %}selected{% endif %}>Fully Furnished</option>
                      <option value="semi_furnished" {% if form.furnishing_type.value == "semi_furnished" %}selected{% endif %}>Semi Furnished</option>
                      <option value="unfurnished" {% if form.furnishing_type.value == "unfurnished" %}selected{% endif %}>Unfurnished</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Property Type</label>
                    <select name="property_type" class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                      <option value="">Select Type</option>
                      <option value="apartment" {% if form.property_type.value == "apartment" %}selected{% endif %}>Apartment</option>
                      <option value="house" {% if form.property_type.value == "house" %}selected{% endif %}>House</option>
                      <option value="villa" {% if form.property_type.value == "villa" %}selected{% endif %}>Villa</option>
                      <option value="commercial" {% if form.property_type.value == "commercial" %}selected{% endif %}>Commercial</option>
                    </select>
                  </div>
                  <div class="flex gap-4 items-center">
                    <label class="flex items-center">
                      <input type="checkbox" name="has_parking" {% if form.has_parking.value %}checked{% endif %} class="h-4 w-4 text-blue-500 focus:ring-blue-400">
                      <span class="ml-2 text-slate-300">Has Parking</span>
                    </label>
                    <label class="flex items-center">
                      <input type="checkbox" name="has_pool" {% if form.has_pool.value %}checked{% endif %} class="h-4 w-4 text-blue-500 focus:ring-blue-400">
                      <span class="ml-2 text-slate-300">Has Pool</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Electronics Section -->
            <div class="category-section" data-category-name="Electronics" style="display:none;">
              <div class="mt-6 p-6 bg-slate-700 rounded-lg border border-slate-600">
                <h3 class="text-lg font-semibold mb-4">Electronics Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Electronics Type</label>
                    <select name="electronics_type" class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                      <option value="">Select Type</option>
                      <option value="phone" {% if form.electronics_type.value == "phone" %}selected{% endif %}>Mobile Phone</option>
                      <option value="laptop" {% if form.electronics_type.value == "laptop" %}selected{% endif %}>Laptop</option>
                      <option value="tablet" {% if form.electronics_type.value == "tablet" %}selected{% endif %}>Tablet</option>
                      <option value="camera" {% if form.electronics_type.value == "camera" %}selected{% endif %}>Camera</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Operating System</label>
                    <select name="operating_system" class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                      <option value="">Select OS</option>
                      <option value="android" {% if form.operating_system.value == "android" %}selected{% endif %}>Android</option>
                      <option value="ios" {% if form.operating_system.value == "ios" %}selected{% endif %}>iOS</option>
                      <option value="windows" {% if form.operating_system.value == "windows" %}selected{% endif %}>Windows</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Storage Capacity</label>
                    <input type="text" name="storage_capacity" value="{{ form.storage_capacity.value|default:'' }}"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" placeholder="e.g., 128GB, 1TB">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Screen Size (inches)</label>
                    <input type="number" step="0.1" name="screen_size" value="{{ form.screen_size.value|default:'' }}"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" placeholder="e.g., 6.1, 15.6">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">RAM</label>
                    <input type="text" name="ram" value="{{ form.ram.value|default:'' }}"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" placeholder="e.g., 8GB, 16GB">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Processor</label>
                    <input type="text" name="processor" value="{{ form.processor.value|default:'' }}"
                           class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors" placeholder="e.g., Intel i7, Snapdragon 888">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Condition</label>
                    <select name="electronics_condition" class="w-full bg-slate-600 border border-slate-500 rounded-lg px-3 py-2 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20 transition-colors">
                      <option value="">Select Condition</option>
                      <option value="new" {% if form.electronics_condition.value == "new" %}selected{% endif %}>New</option>
                      <option value="second_hand" {% if form.electronics_condition.value == "second_hand" %}selected{% endif %}>Second Hand</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- FEATURED AD SECTION -->
            <div class="form-section bg-slate-700 p-6 rounded-lg border border-slate-600">
              <div class="flex items-center mb-6">
                <div class="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center mr-3">
                  <i class="fas fa-crown text-blue-400"></i>
                </div>
                <h2 class="text-xl font-semibold text-white">Featured Dates</h2>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Start Date -->
                <div>
                  <label class="date-label text-slate-300 font-medium mb-2 block">
                    <i class="fas fa-calendar-alt mr-2 text-blue-400"></i>
                    Start Date
                  </label>
                  <div class="relative">
                    <input type="date" name="featured_start_date" 
                          value="{{ form.featured_start_date.value|date:'Y-m-d' }}"
                          class="w-full px-4 py-3 bg-slate-600 text-white rounded-lg border border-slate-500 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors"
                          min="{% now 'Y-m-d' %}"
                          required>
                    <i class="fas fa-chevron-down text-slate-400 absolute right-4 top-1/2 transform -translate-y-1/2"></i>
                  </div>
                  <p class="text-slate-400 text-xs mt-2 pl-1">When your featured promotion begins</p>
                </div>

                <!-- Expiry Date -->
                <div>
                  <label class="date-label text-slate-300 font-medium mb-2 block">
                    <i class="fas fa-clock mr-2 text-blue-400"></i>
                    Expiry Date
                  </label>
                  <div class="relative">
                    <input type="date" name="featured_expiry_date" 
                          value="{{ form.featured_expiry_date.value|date:'Y-m-d' }}"
                          class="w-full px-4 py-3 bg-slate-600 text-white rounded-lg border border-slate-500 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition-colors"
                          min="{% now 'Y-m-d' %}"
                          required>
                    <i class="fas fa-chevron-down text-slate-400 absolute right-4 top-1/2 transform -translate-y-1/2"></i>
                  </div>
                  <p class="text-slate-400 text-xs mt-2 pl-1">When your featured promotion ends</p>
                </div>
              </div>
              
              <div class="mt-6 p-4 bg-slate-600 rounded-lg border border-slate-500">
                <div class="flex items-start">
                  <i class="fas fa-info-circle text-blue-400 mt-1 mr-3"></i>
                  <div>
                    <h3 class="font-medium text-white">Featured Ad Duration</h3>
                    <p class="text-slate-300 text-sm mt-1">Your ad will appear at the top of search results and category pages. Minimum duration is 7 days.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- PAYMENT SECTION -->
            <div class="mt-4 bg-slate-700 p-6 rounded-lg border border-slate-600">
              <h3 class="text-lg font-semibold text-white mb-4">Payment Verification *</h3>
              <label class="block text-sm text-slate-300 mb-2">Payment Screenshot/Photo (JPG, PNG, PDF)</label>
              <input type="file" name="payment_screenshot" accept="image/*,.pdf" required 
                     class="w-full px-4 py-3 border border-slate-500 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-500 file:text-white hover:file:bg-blue-600 bg-slate-600">
              {% if form.payment_screenshot.errors %}
                <div class="text-red-400 text-xs mt-1">{{ form.payment_screenshot.errors }}</div>
              {% endif %}
              <p class="text-slate-400 text-xs mt-2">Accepted formats: JPG, PNG, PDF (Max 5MB)</p>
            </div>

            <!-- IMAGES SECTION -->
            <div class="mt-4 bg-slate-700 p-6 rounded-lg border border-slate-600">
              <h3 class="text-lg font-semibold mb-3">Product Gallery *</h3>
              <p class="text-slate-400 mb-3">Upload up to 10 images. First image will be the cover.</p>

              <div class="mb-4">
                <input type="file" id="imagesInput" name="images" accept="image/*" multiple 
                       class="w-full bg-slate-600 border border-slate-500 rounded-lg px-4 py-3 text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-500 file:text-white hover:file:bg-blue-600">
              </div>
              {% if form.images.errors %}
                <div class="text-red-400 text-xs mt-1">{{ form.images.errors }}</div>
              {% endif %}

              <div id="previewContainer" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4">
                <div class="preview-placeholder border-2 border-dashed border-slate-500 rounded-lg p-6 text-center">
                  <i class="fas fa-cloud-upload-alt text-3xl text-slate-400 mb-2"></i>
                  <p class="text-slate-400 text-sm">Images will appear here</p>
                </div>
              </div>

              <div class="mt-4 flex justify-between items-center">
                <span class="text-slate-400 text-sm" id="imageCount">0 images selected</span>
                <button type="button" id="clearImages" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-sm hidden transition-colors">Clear All</button>
              </div>
            </div>

            <div class="pt-4">
              <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-[1.02]">
                Submit for Review
              </button>
              <p class="text-xs text-slate-400 text-center mt-2">By posting, you agree to our Terms of Service</p>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="success-modal" 
     {% if show_success %}data-show-success="true"{% endif %}
     style="display: none;">
  <div class="success-modal-content">
    <!-- Confetti -->
    <div class="confetti blue-400" style="top: 10%; left: 10%; animation-delay: 0s;"></div>
    <div class="confetti cyan-400" style="top: 5%; left: 30%; animation-delay: 0.5s;"></div>
    <div class="confetti green-400" style="top: 15%; left: 70%; animation-delay: 1s;"></div>
    <div class="confetti blue-500" style="top: 20%; left: 50%; animation-delay: 1.5s;"></div>
    <div class="confetti cyan-500" style="top: 5%; left: 80%; animation-delay: 2s;"></div>
    
    <div style="text-align: center; position: relative; z-index: 10;">
      <div class="success-icon">
        <i class="fas fa-check" style="font-size: 40px; color: white;"></i>
      </div>
      <h3 class="text-2xl font-bold text-white mb-4">Ad Submitted Successfully!</h3>
      <p class="text-slate-300 mb-6">Your ad is now in review. We'll notify you once it's approved.</p>
      <a href="{% url 'index' %}" class="inline-block bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-[1.02]">
        Return to Dashboard
      </a>
    </div>
  </div>
</div>

<style>
/* Success Modal Styles */
.success-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 23, 42, 0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  overflow: auto;
  padding: 20px;
}

.success-modal-content {
  background: rgb(30, 41, 59);
  border-radius: 12px;
  padding: 32px;
  max-width: 448px;
  width: 100%;
  margin: auto;
  position: relative;
  border: 1px solid rgb(51, 65, 85);
  animation: fadeIn 0.5s ease forwards;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  animation: confetti-fall 5s ease-in-out infinite;
}

.confetti.blue-400 { background: #60a5fa; }
.confetti.cyan-400 { background: #22d3ee; }
.confetti.green-400 { background: #4ade80; }
.confetti.blue-500 { background: #3b82f6; }
.confetti.cyan-500 { background: #06b6d4; }

@keyframes confetti-fall {
  0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}

.success-modal-content .success-icon {
  width: 96px;
  height: 96px;
  border-radius: 50%;
  background: linear-gradient(to right, #3b82f6, #06b6d4);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 24px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
}

.success-modal-content h3 {
  font-size: 24px;
  font-weight: 700;
  color: white;
  margin-bottom: 16px;
  text-align: center;
}

.success-modal-content p {
  color: rgb(148, 163, 184);
  margin-bottom: 24px;
  text-align: center;
}

.success-modal-content a {
  display: inline-block;
  background: linear-gradient(to right, #3b82f6, #06b6d4);
  color: white;
  padding: 12px 24px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.3s ease;
}

.success-modal-content a:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.4);
}

/* Additional styles for your template */
.category-picker-btn.ring-2 {
  border-color: transparent;
}

.image-preview {
  transition: transform 0.2s ease;
}

.image-preview:hover {
  transform: scale(1.05);
}

.remove-image-btn {
  transition: all 0.2s ease;
}

.hidden {
  display: none !important;
}

/* File input styling */
.file\:mr-4::file-selector-button {
  margin-right: 1rem;
}

.file\:py-2::file-selector-button {
  padding-top: 0.5rem;
  padding-bottom: 0.5rem;
}

.file\:px-4::file-selector-button {
  padding-left: 1rem;
  padding-right: 1rem;
}

.file\:rounded-full::file-selector-button {
  border-radius: 9999px;
}

.file\:border-0::file-selector-button {
  border-width: 0;
}

.file\:text-sm::file-selector-button {
  font-size: 0.875rem;
}

.file\:font-semibold::file-selector-button {
  font-weight: 600;
}

.file\:bg-blue-50::file-selector-button {
  background-color: #eff6ff;
}

.file\:text-blue-700::file-selector-button {
  color: #1d4ed8;
}

.hover\:file\:bg-blue-100::file-selector-button:hover {
  background-color: #dbeafe;
}

.file\:bg-blue-500::file-selector-button {
  background-color: #3b82f6;
}

.file\:text-white::file-selector-button {
  color: white;
}

.hover\:file\:bg-blue-600::file-selector-button:hover {
  background-color: #2563eb;
}

/* Date input improvements */
input[type="date"]::-webkit-calendar-picker-indicator {
  filter: invert(0.6);
  cursor: pointer;
}

input[type="date"]::-webkit-calendar-picker-indicator:hover {
  filter: invert(0.8);
}

/* Focus styles for better accessibility */
input:focus, select:focus, textarea:focus {
  outline: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Load Font Awesome if not already loaded
  if (!document.querySelector('link[href*="font-awesome"]')) {
    const faLink = document.createElement('link');
    faLink.rel = 'stylesheet';
    faLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
    document.head.appendChild(faLink);
  }

  // Category selection logic
  const categorySelect = document.getElementById('categorySelect');
  const categorySections = document.querySelectorAll('.category-section');

  console.log('Category select element:', categorySelect);
  console.log('Category sections found:', categorySections.length);

  function hideAllCategorySections() {
    categorySections.forEach(section => {
      section.style.display = 'none';
    });
  }

  function showCategorySection(categoryName) {
    hideAllCategorySections();
    const section = document.querySelector(`.category-section[data-category-name="${categoryName}"]`);
    if (section) {
      section.style.display = 'block';
      console.log('Showing category section for:', categoryName);
    } else {
      console.log('No category section found for:', categoryName);
    }
  }

  // Event listener for select change
  if (categorySelect) {
    categorySelect.addEventListener('change', function() {
      const selectedOption = categorySelect.options[categorySelect.selectedIndex];
      const categoryName = selectedOption.text;
      showCategorySection(categoryName);
    });
  }

  // Initialize category if pre-selected
  const initialCategoryId = categorySelect ? categorySelect.value : null;
  console.log('Initial category ID:', initialCategoryId);

  if (initialCategoryId && initialCategoryId !== '') {
    const selectedOption = categorySelect.options[categorySelect.selectedIndex];
    const categoryName = selectedOption.text;
    showCategorySection(categoryName);
  } else {
    hideAllCategorySections();
  }

  // Form validation (optional, since 'required' attribute is on select)
  const form = document.getElementById('productForm');
  if (form) {
    form.addEventListener('submit', function(e) {
      const categoryValue = categorySelect ? categorySelect.value : null;
      console.log('Form submit - checking category value:', categoryValue);
      
      if (!categoryValue || categoryValue === '') {
        e.preventDefault();
        alert('Please select a category for your ad.');
        return false;
      }
      
      console.log('Category validation passed, value is:', categoryValue);
      return true;
    });
  }

  // Image Upload Functionality
  const imagesInput = document.getElementById('imagesInput');
  const previewContainer = document.getElementById('previewContainer');
  const imageCount = document.getElementById('imageCount');
  const clearImagesBtn = document.getElementById('clearImages');

  function handleImageSelection(event) {
    const files = event.target.files;
    
    if (files.length === 0) return;

    // Clear existing previews
    const existingPreviews = previewContainer.querySelectorAll('.image-preview');
    existingPreviews.forEach(preview => preview.remove());
    
    // Remove placeholder
    const placeholder = previewContainer.querySelector('.preview-placeholder');
    if (placeholder) {
      placeholder.remove();
    }

    // Create preview for each file
    Array.from(files).forEach((file, index) => {
      if (!file.type.startsWith('image/')) return;

      const reader = new FileReader();
      
      reader.onload = function(e) {
        const previewDiv = document.createElement('div');
        previewDiv.className = 'image-preview relative group bg-slate-600 rounded-lg overflow-hidden';
        previewDiv.innerHTML = `
          <img src="${e.target.result}" class="w-full h-32 object-cover" alt="Preview">
          <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center">
            <button type="button" class="remove-image-btn opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-red-600 hover:bg-red-700 text-white p-2 rounded-full">
              <i class="fas fa-times text-xs"></i>
            </button>
          </div>
          ${index === 0 ? `
            <div class="absolute top-2 left-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded">
              <i class="fas fa-star mr-1"></i>Cover
            </div>
          ` : ''}
        `;
        
        // Add remove functionality
        const removeBtn = previewDiv.querySelector('.remove-image-btn');
        removeBtn.addEventListener('click', function() {
          previewDiv.remove();
          updateImageCount();
          
          // If no images left, show placeholder
          if (previewContainer.children.length === 0) {
            previewContainer.innerHTML = `
              <div class="preview-placeholder border-2 border-dashed border-slate-500 rounded-lg p-6 text-center col-span-4">
                <i class="fas fa-cloud-upload-alt text-3xl text-slate-400 mb-2"></i>
                <p class="text-slate-400 text-sm">Images will appear here</p>
              </div>
            `;
            clearImagesBtn.classList.add('hidden');
          }
        });
        
        previewContainer.appendChild(previewDiv);
      };
      
      reader.readAsDataURL(file);
    });

    updateImageCount();
    clearImagesBtn.classList.remove('hidden');
  }

  function updateImageCount() {
    const previewCount = previewContainer.querySelectorAll('.image-preview').length;
    imageCount.textContent = `${previewCount} image${previewCount !== 1 ? 's' : ''} selected`;
  }

  function clearAllImages() {
    previewContainer.innerHTML = `
      <div class="preview-placeholder border-2 border-dashed border-slate-500 rounded-lg p-6 text-center col-span-4">
        <i class="fas fa-cloud-upload-alt text-3xl text-slate-400 mb-2"></i>
        <p class="text-slate-400 text-sm">Images will appear here</p>
      </div>
    `;
    imagesInput.value = '';
    clearImagesBtn.classList.add('hidden');
    updateImageCount();
  }

  // Event listeners for images
  if (imagesInput) {
    imagesInput.addEventListener('change', handleImageSelection);
  }
  
  if (clearImagesBtn) {
    clearImagesBtn.addEventListener('click', clearAllImages);
  }

  // Success Modal Functionality
  const successModal = document.getElementById('successModal');

  // Check if we should show success modal based on Django context
  if (successModal && successModal.dataset.showSuccess === 'true') {
    successModal.style.display = 'flex';
    createConfetti();
  }

  function createConfetti() {
    const container = document.querySelector('.success-modal-content');
    if (!container) return;
    
    const colors = ['blue-400', 'cyan-400', 'green-400', 'blue-500', 'cyan-500'];
    
    // Clear existing confetti
    const existingConfetti = container.querySelectorAll('.confetti');
    existingConfetti.forEach(confetti => confetti.remove());
    
    // Create new confetti
    for (let i = 0; i < 20; i++) {
      const confetti = document.createElement('div');
      confetti.className = `confetti ${colors[Math.floor(Math.random() * colors.length)]}`;
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.top = Math.random() * -50 + 'px';
      confetti.style.animationDelay = Math.random() * 5 + 's';
      container.appendChild(confetti);
    }
  }

  function closeSuccessModal() {
    if (successModal) {
      successModal.style.display = 'none';
    }
  }

  // Close modal when clicking outside content
  if (successModal) {
    successModal.addEventListener('click', function(e) {
      if (e.target === successModal) {
        closeSuccessModal();
      }
    });
  }

  // Form validation functions from your original template
  function restrictInput(inputElement, regex, errorElement, errorMessage) {
    inputElement.addEventListener('input', function () {
      // Prevent slashes
      if (inputElement.value.includes('/')) {
        inputElement.value = inputElement.value.replace('/', '');
        errorElement.style.display = 'block';
        errorElement.textContent = 'Slashes (/) are not allowed.';
      } else if (inputElement.value && !regex.test(inputElement.value)) {
        errorElement.style.display = 'block';
        errorElement.textContent = errorMessage;
      } else {
        errorElement.style.display = 'none';
      }
    });
  }

  // Add validation for specific fields if they exist
  const priceInput = document.querySelector('input[name="price"]');
  if (priceInput) {
    const priceError = document.createElement('span');
    priceError.className = 'error-message';
    priceError.style.cssText = 'color: red; display: none; font-size: 12px;';
    priceInput.parentNode.appendChild(priceError);
    
    restrictInput(
      priceInput,
      /^\d+(\.\d{1,2})?$/,
      priceError,
      'Invalid price format. Use numbers only (e.g., 99.99).'
    );
  }

  // Add similar validation for other fields as needed
});
</script>
{% endblock %}